# 创建自定义任务

## 获得路径

GIA直接使用的路径被称为TLPP路径。有关它的介绍，参考[TLPP](./dev/TianLiPositioningPath.md)

推荐使用路径记录器获得TLPP路径。参考[路径记录器](./record_path.md)

使用路径记录器获得路径json文件后，可以在`编辑路径并制作自定义任务`页面，选择`上传路径json文件`上传文件，并点击上传按钮。TLPP路径和地图将会被显示。

## 从空荧酒馆路线生成TLPP路线

你可以在空荧酒馆中绘制路线，然后在GIA中导入。

1. 在空荧酒馆中创建新画布，打开编辑模式
2. 参照空荧酒馆中的说明操作，路线应从传送锚点或七天神像开始。
3. 只有方形控制点会被使用，圆形控制点将被抛弃。
4. 编辑完成后导出画布为json文件
5. 在GIA中，上传画布文件。检查无误后，填写采集物名称和类型，点击`将酒馆路径转换为TLPP路径`

### 注意事项

1. 一个画布应该只有一条路线
2. 只有方形控制点会被使用，圆形控制点将被抛弃。
3. 生成后，如果TLPP路线编辑界面有TLPP内容，原有TLPP路线将被覆盖。

## 编辑路径和创建自定义任务

### 优化路径

导入后，可以按`优化路径`按钮，删除不必要的点位。

### 在空荧酒馆里修改

如果有点位误差，可以将TLPP转换为空荧酒馆的路线，并在空荧酒馆中编辑。方法如下：

1. 点击`导出为酒馆路径并在酒馆中编辑`
2. 打开空荧酒馆，导入GIA生成的json画布文件
3. 在空荧酒馆里编辑。注意：只有方形控制点有效，圆形控制点是无效的。也不能绘制曲线。GIA只会识别有方形控制点形成的折线路线。
4. 完成后，在空荧酒馆里导出画布。
5. 回到GIA，导入空荧酒馆路径
6. 检查空荧酒馆路线是否合理，点击`使用酒馆路线修正TLPP路径`，不要点击`将酒馆路径转换为TLPP路径`。
7. 空荧酒馆的路线将会同步到TLPP路径界面。注意：只有TLPP路径界面是生成自定义任务所使用的，空荧酒馆必须先转换成TLPP路线才行。

## 生成自定义任务

1. 打开GUI，点击`转换天理路径为自定义任务`按钮
2. 填写采集物名，任务名，文件名，作者等信息，按照提示勾选下面的额外设置。
3. 选择生成的json文件(位于dev_assets/tlpp下)，点击`生成自定义任务`按钮。等待生成完成。
4. 点击`自定义任务设置`按钮，启用刚刚生成的自定义任务
5. 在主菜单启动自定义任务，测试一下

## 额外设置

- 采集物是否在悬崖上
- 是否禁用自动吸附 [自动吸附功能介绍](../zh_CN/dev/TianLiCopilot.md)
- 是否在**所有**路径点处启动自动吸附 [主动采集介绍](../zh_CN/dev/TianLiCopilot.md)；即使不选择该项，也会在有可采集物的地方吸附。
- 是否需要纳西妲：启用后，将添加需要纳西妲的提示。即使不启用该功能，仍然会在队伍中有纳西妲的情况下使用纳西妲采集。

注意，路径记录器的采集点的标记依赖于“F”采集标志的显示。如果在记录时没有显示F，那么纳西妲不会被使用；如果是从空荧酒馆生成，会检索已知采集点进行采集。

### 技巧

- 使用纳西妲时，不一定需要将方形控制点标记在采集物上，可标记在采集物附近，并启用`在路径点处启动主动采集`。
- 采集物在悬崖上时，可将方形控制点标记在山脚下，并启用`在路径点处启动主动采集`。

## Caution

- 如果任务需要纳西妲，请勾选对应单选框

## 分享自定义任务

本地自定义任务位置：`./local_edit_missions`

- https://github.com/GenshinImpactAssistant/GIA-Missions 查看具体操作方法
- 如果不会PR，开个issue，把自定义任务扔上去

## TODO（需要帮助）

- 生成圣遗物类型自定义任务（添加一个选项，设置meta的tags类型为采集/圣遗物）
- 保存GUI输入结果

# 写的比较随意，有看不懂的地方欢迎提issue！
